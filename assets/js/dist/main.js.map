{"version":3,"file":"main.js","sourceRoot":"","sources":["../../../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["import initUI from \"./app/ui.js\";\nimport { installLiveEditGuardrails, showToast } from \"./app/guardrails.js\";\nimport { UI_REACT_ISLANDS_ENABLED } from \"./app/game/config.js\";\n\nconst releaseStamp = typeof RLS_RELEASE !== \"undefined\" ? RLS_RELEASE : null;\nconst guardrails = installLiveEditGuardrails(releaseStamp);\nlet bootBlocked = false;\n\nif (typeof window !== \"undefined\") {\n  const missing = [];\n  if (!Array.isArray(THEMES) || !THEMES.length) missing.push(\"THEMES\");\n  if (!Array.isArray(MOODS) || !MOODS.length) missing.push(\"MOODS\");\n  if (!Array.isArray(ALIGNMENTS) || !ALIGNMENTS.length) missing.push(\"ALIGNMENTS\");\n  if (!CHART_SIZES) missing.push(\"CHART_SIZES\");\n  if (!ECONOMY_BASELINES) missing.push(\"ECONOMY_BASELINES\");\n  if (!Number.isFinite(SLOT_COUNT)) missing.push(\"SLOT_COUNT\");\n  const missingRoots = [];\n  if (typeof document !== \"undefined\") {\n    if (!document.getElementById(\"app\")) missingRoots.push(\"#app\");\n    if (!document.getElementById(\"mainMenu\")) missingRoots.push(\"#mainMenu\");\n  }\n  if (missing.length || missingRoots.length) {\n    const detail = [\n      missing.length ? `Missing data globals: ${missing.join(\", \")}` : \"\",\n      missingRoots.length ? `Missing DOM roots: ${missingRoots.join(\", \")}` : \"\"\n    ].filter(Boolean).join(\" | \");\n    console.error(\"[boot] Missing dependencies detected.\", { missing, missingRoots });\n    guardrails.handleFatal(new Error(`Boot dependencies missing. ${detail}`));\n    bootBlocked = true;\n  }\n}\n\nif (typeof document !== \"undefined\" && releaseStamp?.patchId) {\n  document.documentElement.dataset.release = releaseStamp.patchId;\n}\nif (typeof window !== \"undefined\") {\n  const root = window as typeof window & { UI_REACT_ISLANDS_ENABLED?: boolean };\n  root.UI_REACT_ISLANDS_ENABLED = UI_REACT_ISLANDS_ENABLED;\n}\n\nif (!bootBlocked) {\n  initUI()\n    .then(() => {\n      if (typeof sessionStorage === \"undefined\") return;\n      const releaseChanged = sessionStorage.getItem(\"rls_release_changed\");\n      if (!releaseChanged) return;\n      sessionStorage.removeItem(\"rls_release_changed\");\n      showToast(\"Update available\", \"A new build is ready. Reload to clear stale cached assets.\", {\n        tone: \"warn\",\n        actions: [{ label: \"Reload\", handler: () => window.location.reload() }]\n      });\n    })\n    .catch((error) => {\n      console.error(\"initUI error:\", error);\n      guardrails.handleFatal(error);\n    });\n}\n\nif (\"serviceWorker\" in navigator) {\n  const params = new URLSearchParams(window.location.search);\n  const swDisabled = params.get(\"sw\") === \"off\" || params.has(\"nosw\");\n  const isLocalHost = [\"localhost\", \"127.0.0.1\", \"0.0.0.0\"].includes(window.location.hostname);\n  const allowServiceWorker = !swDisabled && !isLocalHost;\n  const cleanupKey = \"rls_sw_cleanup\";\n\n  const purgeServiceWorker = async () => {\n    const hadController = !!navigator.serviceWorker.controller;\n    const registrations = await navigator.serviceWorker.getRegistrations();\n    await Promise.all(registrations.map((registration) => registration.unregister()));\n    if (\"caches\" in window) {\n      const keys = await caches.keys();\n      await Promise.all(\n        keys\n          .filter((key) => key.startsWith(\"rls-cache-\"))\n          .map((key) => caches.delete(key))\n      );\n    }\n    return { hadController, didCleanup: registrations.length > 0 };\n  };\n\n  if (allowServiceWorker) {\n    window.addEventListener(\"load\", () => {\n      navigator.serviceWorker.register(\"./service-worker.js\")\n        .then((registration) => registration.update())\n        .catch((error) => console.warn(\"Service worker registration failed.\", error));\n    });\n  } else {\n    window.addEventListener(\"load\", () => {\n      purgeServiceWorker()\n        .then(({ hadController, didCleanup }) => {\n          if (!didCleanup || !hadController) return;\n          if (typeof sessionStorage === \"undefined\") return;\n          if (sessionStorage.getItem(cleanupKey)) return;\n          sessionStorage.setItem(cleanupKey, \"1\");\n          window.location.reload();\n        })\n        .catch((error) => console.warn(\"Service worker cleanup failed.\", error));\n    });\n  }\n}\n"]}