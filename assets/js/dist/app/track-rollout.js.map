{"version":3,"file":"track-rollout.js","sourceRoot":"","sources":["../../../../src/app/track-rollout.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  fetchRolloutStrategyTemplateByFingerprint,\n  fetchRolloutStrategyTemplateById,\n  fetchTrackRolloutInstanceByTrackId,\n  listRolloutStrategyTemplates as listTemplatesFromDb,\n  upsertRolloutStrategyTemplate,\n  upsertTrackRolloutInstance\n} from \"./db.js\";\n\ntype RolloutTemplateSource = \"premade\" | \"player_saved\";\ntype TrackRolloutWeightKey = \"interviews\" | \"live\" | \"eyeriSocial\" | \"tour\";\ntype TrackRolloutFocusKey = TrackRolloutWeightKey | \"musicVideo\";\ntype TrackRolloutToggleKey = \"musicVideoOn\" | \"tourTieInOn\" | \"primeTimeLiveOn\" | \"isSingle\";\ntype TrackRolloutWeights = Record<TrackRolloutWeightKey, number>;\ntype TrackRolloutToggles = Record<TrackRolloutToggleKey, boolean>;\ntype TrackRolloutFocusPair = { primary: TrackRolloutFocusKey; secondary: TrackRolloutFocusKey | null };\ntype TrackRolloutTemplateRecord = {\n  template_id: string;\n  name: string;\n  primary_focus: TrackRolloutFocusKey;\n  secondary_focus: TrackRolloutFocusKey | null;\n  weights_json: TrackRolloutWeights;\n  toggles_json: TrackRolloutToggles;\n  created_source: RolloutTemplateSource;\n  fingerprint: string;\n  created_at_ts: number;\n};\ntype TrackRolloutInstanceRecord = {\n  instance_id: string;\n  track_id: string;\n  template_id: string | null;\n  primary_focus: TrackRolloutFocusKey;\n  secondary_focus: TrackRolloutFocusKey | null;\n  weights_json: TrackRolloutWeights;\n  toggles_json: TrackRolloutToggles;\n  status: \"draft\" | \"active\" | \"completed\" | string;\n  updated_at_ts: number;\n};\n\nconst TRACK_ROLLOUT_WEIGHT_KEYS: TrackRolloutWeightKey[] = [\"interviews\", \"live\", \"eyeriSocial\", \"tour\"];\nconst TRACK_ROLLOUT_TOGGLE_KEYS: TrackRolloutToggleKey[] = [\"musicVideoOn\", \"tourTieInOn\", \"primeTimeLiveOn\", \"isSingle\"];\nconst TRACK_ROLLOUT_FOCUS_KEYS: TrackRolloutFocusKey[] = [\"interviews\", \"live\", \"eyeriSocial\", \"tour\", \"musicVideo\"];\nconst TRACK_ROLLOUT_FOCUS_LABELS: Record<TrackRolloutFocusKey, string> = {\n  interviews: \"Interviews\",\n  live: \"Live performance\",\n  eyeriSocial: \"eyeriSocial\",\n  tour: \"Tour\",\n  musicVideo: \"Music video\"\n};\nconst DEFAULT_WEIGHTS: TrackRolloutWeights = { interviews: 25, live: 25, eyeriSocial: 25, tour: 25 };\nconst DEFAULT_TOGGLES: TrackRolloutToggles = {\n  musicVideoOn: false,\n  tourTieInOn: false,\n  primeTimeLiveOn: false,\n  isSingle: true\n};\nconst PREMADE_DATA_PATH = \"data/rollout_premades.json\";\n\nfunction clampNumber(value, min, max) {\n  const safe = Number.isFinite(value) ? value : 0;\n  return Math.max(min, Math.min(max, safe));\n}\n\nfunction normalizeToggleValue(value: unknown) {\n  return Boolean(value);\n}\n\nfunction normalizeToggles(toggles?: Partial<TrackRolloutToggles> | null) {\n  const next: TrackRolloutToggles = { ...DEFAULT_TOGGLES };\n  TRACK_ROLLOUT_TOGGLE_KEYS.forEach((key) => {\n    next[key] = normalizeToggleValue(toggles?.[key]);\n  });\n  return next;\n}\n\nfunction sanitizeWeights(weights?: Partial<TrackRolloutWeights> | null) {\n  const next = {} as TrackRolloutWeights;\n  TRACK_ROLLOUT_WEIGHT_KEYS.forEach((key) => {\n    next[key] = clampNumber(weights?.[key], 0, 100);\n  });\n  return next;\n}\n\nfunction scaleWeights(weights: TrackRolloutWeights) {\n  const values = TRACK_ROLLOUT_WEIGHT_KEYS.map((key) => weights[key] || 0);\n  const sum = values.reduce((total, value) => total + value, 0);\n  if (!sum) return { weights: { ...DEFAULT_WEIGHTS }, sum: 100, rawSum: 0 };\n  const scale = 100 / sum;\n  const scaled = values.map((value) => value * scale);\n  const rounded = scaled.map((value) => Math.round(value));\n  const remainders = scaled.map((value) => value - Math.floor(value));\n  let remainder = 100 - rounded.reduce((total, value) => total + value, 0);\n  if (remainder !== 0) {\n    const indices = TRACK_ROLLOUT_WEIGHT_KEYS.map((_, index) => index);\n    if (remainder > 0) {\n      indices.sort((a, b) => {\n        if (remainders[b] !== remainders[a]) return remainders[b] - remainders[a];\n        return a - b;\n      });\n      for (let i = 0; i < remainder; i += 1) {\n        const index = indices[i % indices.length];\n        rounded[index] += 1;\n      }\n    } else {\n      indices.sort((a, b) => {\n        if (remainders[a] !== remainders[b]) return remainders[a] - remainders[b];\n        return b - a;\n      });\n      let remaining = Math.abs(remainder);\n      let cursor = 0;\n      while (remaining > 0 && cursor < indices.length * 3) {\n        const index = indices[cursor % indices.length];\n        if (rounded[index] > 0) {\n          rounded[index] -= 1;\n          remaining -= 1;\n        }\n        cursor += 1;\n      }\n    }\n  }\n  const normalized = {} as TrackRolloutWeights;\n  TRACK_ROLLOUT_WEIGHT_KEYS.forEach((key, index) => {\n    normalized[key] = rounded[index];\n  });\n  return { weights: normalized, sum: 100, rawSum: sum };\n}\n\nfunction normalizeWeights(weights?: Partial<TrackRolloutWeights> | null, { bucket = false }: { bucket?: boolean } = {}) {\n  const clamped = sanitizeWeights(weights);\n  if (bucket) {\n    TRACK_ROLLOUT_WEIGHT_KEYS.forEach((key) => {\n      clamped[key] = Math.round(clamped[key] / 5) * 5;\n    });\n  }\n  return scaleWeights(clamped);\n}\n\nfunction deriveFocuses(weights: TrackRolloutWeights): TrackRolloutFocusPair {\n  const safe = sanitizeWeights(weights);\n  const entries = TRACK_ROLLOUT_WEIGHT_KEYS.map((key) => ({ key, value: safe[key] }));\n  const sum = entries.reduce((total, entry) => total + entry.value, 0);\n  if (!sum) {\n    return { primary: \"interviews\", secondary: \"live\" };\n  }\n  let primary = entries[0].key;\n  let primaryValue = entries[0].value;\n  entries.forEach((entry) => {\n    if (entry.value > primaryValue) {\n      primary = entry.key;\n      primaryValue = entry.value;\n    }\n  });\n  const secondaryEntries = entries.filter((entry) => entry.key !== primary);\n  secondaryEntries.sort((a, b) => {\n    if (b.value !== a.value) return b.value - a.value;\n    return TRACK_ROLLOUT_WEIGHT_KEYS.indexOf(a.key) - TRACK_ROLLOUT_WEIGHT_KEYS.indexOf(b.key);\n  });\n  const secondary = secondaryEntries[0];\n  if (!secondary) return { primary, secondary: null };\n  if (secondary.value >= 25 && primaryValue - secondary.value <= 15) {\n    return { primary, secondary: secondary.key };\n  }\n  return { primary, secondary: null };\n}\n\nfunction isValidFocus(value: unknown): value is TrackRolloutFocusKey {\n  return TRACK_ROLLOUT_FOCUS_KEYS.includes(value as TrackRolloutFocusKey);\n}\n\nfunction resolveFocusPair({\n  weights,\n  primaryFocus,\n  secondaryFocus\n}: {\n  weights: TrackRolloutWeights;\n  primaryFocus?: TrackRolloutFocusKey | null;\n  secondaryFocus?: TrackRolloutFocusKey | null;\n}): TrackRolloutFocusPair {\n  const primary = isValidFocus(primaryFocus) ? primaryFocus : null;\n  const secondary = isValidFocus(secondaryFocus) ? secondaryFocus : null;\n  if (primary) {\n    return { primary, secondary: secondary && secondary !== primary ? secondary : null };\n  }\n  return deriveFocuses(weights);\n}\n\nfunction focusLabel(focus?: TrackRolloutFocusKey | null) {\n  if (!focus) return \"Focus\";\n  return TRACK_ROLLOUT_FOCUS_LABELS[focus] || focus;\n}\n\nfunction buildName(primary?: TrackRolloutFocusKey | null, secondary?: TrackRolloutFocusKey | null) {\n  if (!primary) return \"Focus\";\n  const primaryLabel = focusLabel(primary);\n  if (secondary) {\n    return `${primaryLabel} + ${focusLabel(secondary)} focus`;\n  }\n  return `${primaryLabel} focus`;\n}\n\nfunction buildFingerprint({\n  primary,\n  secondary,\n  weights,\n  toggles\n}: {\n  primary: TrackRolloutFocusKey;\n  secondary: TrackRolloutFocusKey | null;\n  weights: TrackRolloutWeights;\n  toggles: TrackRolloutToggles | Partial<TrackRolloutToggles>;\n}) {\n  const resolved = normalizeWeights(weights, { bucket: true }).weights;\n  const flags = normalizeToggles(toggles);\n  const secondaryLabel = secondary || \"none\";\n  return [\n    `p=${primary};s=${secondaryLabel}`,\n    `w=i:${resolved.interviews},l:${resolved.live},s:${resolved.eyeriSocial},t:${resolved.tour}`,\n    `t=video:${flags.musicVideoOn ? 1 : 0},tour:${flags.tourTieInOn ? 1 : 0},prime:${flags.primeTimeLiveOn ? 1 : 0},single:${flags.isSingle ? 1 : 0}`\n  ].join(\"|\");\n}\n\nfunction buildId(prefix) {\n  if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\n    return `${prefix}-${crypto.randomUUID()}`;\n  }\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\nfunction buildTemplateRecord({\n  templateId = null,\n  createdAt = null,\n  createdSource = \"player_saved\",\n  weights = DEFAULT_WEIGHTS,\n  toggles = DEFAULT_TOGGLES,\n  primaryFocus = null,\n  secondaryFocus = null\n}: {\n  templateId?: string | null;\n  createdAt?: number | null;\n  createdSource?: RolloutTemplateSource;\n  weights?: TrackRolloutWeights | Partial<TrackRolloutWeights>;\n  toggles?: TrackRolloutToggles | Partial<TrackRolloutToggles>;\n  primaryFocus?: TrackRolloutFocusKey | null;\n  secondaryFocus?: TrackRolloutFocusKey | null;\n} = {}): TrackRolloutTemplateRecord {\n  const bucketed = normalizeWeights(weights, { bucket: true }).weights;\n  const focus = resolveFocusPair({ weights: bucketed, primaryFocus, secondaryFocus });\n  const fingerprint = buildFingerprint({\n    primary: focus.primary,\n    secondary: focus.secondary,\n    weights: bucketed,\n    toggles\n  });\n  return {\n    template_id: templateId || buildId(\"RT\"),\n    name: buildName(focus.primary, focus.secondary),\n    primary_focus: focus.primary,\n    secondary_focus: focus.secondary,\n    weights_json: bucketed,\n    toggles_json: normalizeToggles(toggles),\n    created_source: createdSource,\n    fingerprint,\n    created_at_ts: Number.isFinite(createdAt) ? createdAt : Date.now()\n  };\n}\n\nasync function listTrackRolloutTemplates(): Promise<TrackRolloutTemplateRecord[]> {\n  const templates = await listTemplatesFromDb() as TrackRolloutTemplateRecord[];\n  return templates.slice().sort((a, b) => {\n    const sourceA = a?.created_source === \"premade\" ? 0 : 1;\n    const sourceB = b?.created_source === \"premade\" ? 0 : 1;\n    if (sourceA !== sourceB) return sourceA - sourceB;\n    return String(a?.name || \"\").localeCompare(String(b?.name || \"\"));\n  });\n}\n\nlet templateCache: TrackRolloutTemplateRecord[] | null = null;\nlet templateCacheUpdatedAt = 0;\n\nfunction setTrackRolloutTemplateCache(templates?: TrackRolloutTemplateRecord[] | null) {\n  templateCache = Array.isArray(templates) ? templates.slice() : [];\n  templateCacheUpdatedAt = Date.now();\n}\n\nfunction getTrackRolloutTemplateCache() {\n  return templateCache;\n}\n\nfunction getTrackRolloutTemplateCacheUpdatedAt() {\n  return templateCacheUpdatedAt;\n}\n\nasync function fetchTrackRolloutTemplateById(templateId?: string | null) {\n  return fetchRolloutStrategyTemplateById(templateId);\n}\n\nasync function saveTrackRolloutTemplate({\n  weights,\n  toggles,\n  primaryFocus,\n  secondaryFocus,\n  createdSource = \"player_saved\"\n}: {\n  weights?: TrackRolloutWeights | Partial<TrackRolloutWeights>;\n  toggles?: TrackRolloutToggles | Partial<TrackRolloutToggles>;\n  primaryFocus?: TrackRolloutFocusKey | null;\n  secondaryFocus?: TrackRolloutFocusKey | null;\n  createdSource?: RolloutTemplateSource;\n} = {}) {\n  const record = buildTemplateRecord({\n    weights,\n    toggles,\n    primaryFocus,\n    secondaryFocus,\n    createdSource\n  });\n  const existing = await fetchRolloutStrategyTemplateByFingerprint(record.fingerprint);\n  if (existing) {\n    return { template: existing, created: false, fingerprint: record.fingerprint };\n  }\n  await upsertRolloutStrategyTemplate(record);\n  return { template: record, created: true, fingerprint: record.fingerprint };\n}\n\nasync function loadPremadeRolloutTemplates() {\n  try {\n    const response = await fetch(PREMADE_DATA_PATH, { cache: \"no-store\" });\n    if (!response.ok) return [];\n    const data = await response.json();\n    return Array.isArray(data) ? data : [];\n  } catch (error) {\n    console.warn(\"[track-rollout] Premade rollout templates unavailable.\", error);\n    return [];\n  }\n}\n\nasync function ensurePremadeRolloutTemplates() {\n  const premades = await loadPremadeRolloutTemplates();\n  if (!premades.length) return { created: 0, updated: 0, total: 0 };\n  let created = 0;\n  let updated = 0;\n  for (const entry of premades) {\n    const record = buildTemplateRecord({\n      weights: entry?.weights || DEFAULT_WEIGHTS,\n      toggles: entry?.toggles || DEFAULT_TOGGLES,\n      primaryFocus: entry?.primary_focus || null,\n      secondaryFocus: entry?.secondary_focus || null,\n      createdSource: \"premade\"\n    });\n    const existing = await fetchRolloutStrategyTemplateByFingerprint(record.fingerprint);\n    if (existing) {\n      const next = {\n        ...record,\n        template_id: existing.template_id,\n        created_at_ts: existing.created_at_ts || record.created_at_ts\n      };\n      await upsertRolloutStrategyTemplate(next);\n      updated += 1;\n    } else {\n      await upsertRolloutStrategyTemplate(record);\n      created += 1;\n    }\n  }\n  return { created, updated, total: premades.length };\n}\n\nasync function saveTrackRolloutInstance({\n  trackId,\n  templateId = null,\n  weights = DEFAULT_WEIGHTS,\n  toggles = DEFAULT_TOGGLES,\n  primaryFocus = null,\n  secondaryFocus = null,\n  status = \"draft\"\n}: {\n  trackId?: string | null;\n  templateId?: string | null;\n  weights?: TrackRolloutWeights | Partial<TrackRolloutWeights>;\n  toggles?: TrackRolloutToggles | Partial<TrackRolloutToggles>;\n  primaryFocus?: TrackRolloutFocusKey | null;\n  secondaryFocus?: TrackRolloutFocusKey | null;\n  status?: \"draft\" | \"active\" | \"completed\" | string;\n} = {}): Promise<TrackRolloutInstanceRecord | null> {\n  if (!trackId) return null;\n  const normalized = normalizeWeights(weights, { bucket: false }).weights;\n  const focus = resolveFocusPair({ weights: normalized, primaryFocus, secondaryFocus });\n  const existing = await fetchTrackRolloutInstanceByTrackId(trackId);\n  const instance = {\n    instance_id: existing?.instance_id || buildId(\"TRI\"),\n    track_id: trackId,\n    template_id: templateId || null,\n    primary_focus: focus.primary,\n    secondary_focus: focus.secondary,\n    weights_json: normalized,\n    toggles_json: normalizeToggles(toggles),\n    status: status || \"draft\",\n    updated_at_ts: Date.now()\n  };\n  await upsertTrackRolloutInstance(instance);\n  return instance;\n}\n\nexport {\n  TRACK_ROLLOUT_WEIGHT_KEYS,\n  TRACK_ROLLOUT_TOGGLE_KEYS,\n  TRACK_ROLLOUT_FOCUS_KEYS,\n  TRACK_ROLLOUT_FOCUS_LABELS,\n  DEFAULT_WEIGHTS as TRACK_ROLLOUT_DEFAULT_WEIGHTS,\n  DEFAULT_TOGGLES as TRACK_ROLLOUT_DEFAULT_TOGGLES,\n  sanitizeWeights,\n  normalizeWeights,\n  deriveFocuses,\n  resolveFocusPair,\n  focusLabel,\n  buildName,\n  buildFingerprint,\n  listTrackRolloutTemplates,\n  fetchTrackRolloutTemplateById,\n  saveTrackRolloutTemplate,\n  setTrackRolloutTemplateCache,\n  getTrackRolloutTemplateCache,\n  getTrackRolloutTemplateCacheUpdatedAt,\n  ensurePremadeRolloutTemplates,\n  saveTrackRolloutInstance,\n  fetchTrackRolloutInstanceByTrackId as fetchTrackRolloutInstance\n};\n"]}