{"version":3,"file":"file-storage.js","sourceRoot":"","sources":["../../../../src/app/file-storage.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-nocheck\nimport { clearFileHandle, fetchFileHandle, listChartSnapshots, storeFileHandle, storeChartSnapshot } from \"./db.js\";\n\nconst STORAGE_HANDLE_ID = \"rls_external_storage_root_v1\";\nconst STORAGE_MANIFEST_NAME = \"rls-storage.json\";\nconst USAGE_DIR = \"usage-logs\";\nconst SAVES_DIR = \"saves\";\nconst DB_DIR = \"database\";\nconst USAGE_WRITE_DEBOUNCE_MS = 1200;\n\nlet cachedHandle = null;\nlet handlePromise = null;\nlet writeQueue = Promise.resolve();\nlet usageWriteTimer = null;\nlet pendingUsageSession = null;\n\nfunction isBrowser() {\n  return typeof window !== \"undefined\";\n}\n\nexport function isExternalStorageSupported() {\n  return isBrowser() && typeof window.showDirectoryPicker === \"function\";\n}\n\nfunction nowIso() {\n  return new Date().toISOString();\n}\n\nfunction getSlotPrefix() {\n  if (typeof SLOT_PREFIX === \"string\" && SLOT_PREFIX) return SLOT_PREFIX;\n  return \"rls_slot_\";\n}\n\nfunction getSlotCount() {\n  return Number.isFinite(SLOT_COUNT) ? SLOT_COUNT : 6;\n}\n\nfunction enqueueWrite(task) {\n  writeQueue = writeQueue.then(task).catch(() => {});\n  return writeQueue;\n}\n\nasync function loadStoredHandle() {\n  if (cachedHandle) return cachedHandle;\n  if (handlePromise) return handlePromise;\n  handlePromise = fetchFileHandle(STORAGE_HANDLE_ID)\n    .then((handle) => {\n      cachedHandle = handle || null;\n      return cachedHandle;\n    })\n    .finally(() => {\n      handlePromise = null;\n    });\n  return handlePromise;\n}\n\nasync function ensurePermission(handle, requestPermission = false) {\n  if (!handle) return false;\n  if (typeof handle.queryPermission !== \"function\") return true;\n  const opts = { mode: \"readwrite\" };\n  let permission = await handle.queryPermission(opts);\n  if (permission === \"granted\") return true;\n  if (!requestPermission || typeof handle.requestPermission !== \"function\") return false;\n  permission = await handle.requestPermission(opts);\n  return permission === \"granted\";\n}\n\nexport async function getExternalStorageHandle({ requestPermission = false } = {}) {\n  if (!isExternalStorageSupported()) return null;\n  const handle = await loadStoredHandle();\n  if (!handle) return null;\n  const allowed = await ensurePermission(handle, requestPermission);\n  return allowed ? handle : null;\n}\n\nexport async function requestExternalStorageHandle() {\n  if (!isExternalStorageSupported()) {\n    return { ok: false, reason: \"unsupported\" };\n  }\n  try {\n    const handle = await window.showDirectoryPicker({ id: \"rls-storage\", mode: \"readwrite\" });\n    cachedHandle = handle;\n    await storeFileHandle(STORAGE_HANDLE_ID, handle);\n    const allowed = await ensurePermission(handle, true);\n    if (!allowed) return { ok: false, reason: \"permission\" };\n    await writeStorageManifest(handle, { configuredAt: nowIso() });\n    return { ok: true, handle };\n  } catch (error) {\n    if (error?.name === \"AbortError\") return { ok: false, reason: \"cancelled\" };\n    return { ok: false, reason: \"error\", error };\n  }\n}\n\nexport async function clearExternalStorageHandle() {\n  cachedHandle = null;\n  return clearFileHandle(STORAGE_HANDLE_ID);\n}\n\nexport async function getExternalStorageStatus() {\n  if (!isExternalStorageSupported()) {\n    return { supported: false, status: \"unsupported\" };\n  }\n  const handle = await loadStoredHandle();\n  if (!handle) {\n    return { supported: true, status: \"not-set\" };\n  }\n  const permission = await (async () => {\n    if (typeof handle.queryPermission !== \"function\") return \"granted\";\n    try {\n      return await handle.queryPermission({ mode: \"readwrite\" });\n    } catch {\n      return \"unknown\";\n    }\n  })();\n  return {\n    supported: true,\n    status: permission === \"granted\" ? \"ready\" : permission,\n    name: handle.name || \"External folder\"\n  };\n}\n\nasync function resolveDirectory(root, parts, create = true) {\n  let current = root;\n  for (const part of parts) {\n    if (!part) continue;\n    current = await current.getDirectoryHandle(part, { create });\n  }\n  return current;\n}\n\nasync function writeTextFile(root, parts, content, { append = false } = {}) {\n  if (!root) return false;\n  try {\n    const fileName = parts[parts.length - 1];\n    const dirParts = parts.slice(0, -1);\n    const dir = await resolveDirectory(root, dirParts, true);\n    const fileHandle = await dir.getFileHandle(fileName, { create: true });\n    const writable = await fileHandle.createWritable({ keepExistingData: append });\n    if (append) {\n      const file = await fileHandle.getFile();\n      await writable.seek(file.size);\n    }\n    await writable.write(content);\n    await writable.close();\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function deleteFile(root, parts) {\n  if (!root) return false;\n  try {\n    const fileName = parts[parts.length - 1];\n    const dirParts = parts.slice(0, -1);\n    const dir = await resolveDirectory(root, dirParts, false);\n    await dir.removeEntry(fileName);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function writeStorageManifest(root, extra = {}) {\n  const payload = {\n    app: \"Record Label Simulator\",\n    updatedAt: nowIso(),\n    ...extra\n  };\n  return writeTextFile(root, [STORAGE_MANIFEST_NAME], JSON.stringify(payload, null, 2));\n}\n\nexport function queueUsageSessionWrite(session) {\n  if (!session) return;\n  pendingUsageSession = session;\n  if (usageWriteTimer) return;\n  usageWriteTimer = setTimeout(() => {\n    usageWriteTimer = null;\n    const snapshot = pendingUsageSession;\n    pendingUsageSession = null;\n    if (!snapshot) return;\n    enqueueWrite(async () => {\n      const root = await getExternalStorageHandle();\n      if (!root) return;\n      await writeTextFile(\n        root,\n        [USAGE_DIR, `usage-session-${snapshot.id}.json`],\n        JSON.stringify(snapshot, null, 2)\n      );\n      await writeStorageManifest(root, { lastUsageSession: snapshot.id, lastUsageSyncAt: nowIso() });\n    });\n  }, USAGE_WRITE_DEBOUNCE_MS);\n}\n\nexport function queueSaveSlotWrite(index, payload) {\n  if (!index || !payload) return;\n  enqueueWrite(async () => {\n    const root = await getExternalStorageHandle();\n    if (!root) return;\n    await writeTextFile(root, [SAVES_DIR, `slot-${index}.json`], payload);\n    await writeStorageManifest(root, { lastSaveSyncAt: nowIso(), lastSaveSlot: index });\n  });\n}\n\nexport function queueSaveSlotDelete(index) {\n  if (!index) return;\n  enqueueWrite(async () => {\n    const root = await getExternalStorageHandle();\n    if (!root) return;\n    await deleteFile(root, [SAVES_DIR, `slot-${index}.json`]);\n    await writeStorageManifest(root, { lastSaveSyncAt: nowIso(), lastSaveSlot: index, lastSaveAction: \"delete\" });\n  });\n}\n\nexport function queueChartSnapshotsWrite(snapshots) {\n  if (!Array.isArray(snapshots) || !snapshots.length) return;\n  enqueueWrite(async () => {\n    const root = await getExternalStorageHandle();\n    if (!root) return;\n    const lines = snapshots.map((snap) => JSON.stringify(snap)).join(\"\\n\") + \"\\n\";\n    await writeTextFile(root, [DB_DIR, \"chart-history.ndjson\"], lines, { append: true });\n    await writeStorageManifest(root, { lastChartSyncAt: nowIso(), lastChartSnapshots: snapshots.length });\n  });\n}\n\nexport async function readSaveSlotFromExternal(index) {\n  if (!index) return null;\n  const root = await getExternalStorageHandle();\n  if (!root) return null;\n  try {\n    const dir = await resolveDirectory(root, [SAVES_DIR], false);\n    const fileHandle = await dir.getFileHandle(`slot-${index}.json`);\n    const file = await fileHandle.getFile();\n    const text = await file.text();\n    return JSON.parse(text);\n  } catch {\n    return null;\n  }\n}\n\nexport async function syncExternalStorageNow({ includeSaves = true, includeCharts = true, usageSession = null } = {}) {\n  const root = await getExternalStorageHandle({ requestPermission: true });\n  if (!root) return { ok: false, reason: \"permission\" };\n  const summary = {\n    ok: true,\n    saves: 0,\n    charts: 0,\n    usage: 0\n  };\n  if (includeSaves && typeof localStorage !== \"undefined\") {\n    const prefix = getSlotPrefix();\n    const count = getSlotCount();\n    for (let i = 1; i <= count; i += 1) {\n      const raw = localStorage.getItem(`${prefix}${i}`);\n      if (!raw) continue;\n      const ok = await writeTextFile(root, [SAVES_DIR, `slot-${i}.json`], raw);\n      if (ok) summary.saves += 1;\n    }\n  }\n  if (includeCharts) {\n    const snapshots = await listChartSnapshots();\n    summary.charts = snapshots.length;\n    const payload = JSON.stringify({ exportedAt: nowIso(), count: snapshots.length, snapshots }, null, 2);\n    await writeTextFile(root, [DB_DIR, \"chart-history.json\"], payload);\n    if (snapshots.length) {\n      const lines = snapshots.map((snap) => JSON.stringify(snap)).join(\"\\n\") + \"\\n\";\n      await writeTextFile(root, [DB_DIR, \"chart-history.ndjson\"], lines);\n    }\n  }\n  if (usageSession?.id) {\n    const ok = await writeTextFile(\n      root,\n      [USAGE_DIR, `usage-session-${usageSession.id}.json`],\n      JSON.stringify(usageSession, null, 2)\n    );\n    if (ok) summary.usage = 1;\n  }\n  await writeStorageManifest(root, {\n    lastSyncAt: nowIso(),\n    saveCount: summary.saves,\n    chartCount: summary.charts,\n    usageCount: summary.usage\n  });\n  return summary;\n}\n\nexport async function importChartHistoryFromExternal() {\n  const root = await getExternalStorageHandle({ requestPermission: true });\n  if (!root) return { ok: false, reason: \"permission\" };\n  try {\n    const dir = await resolveDirectory(root, [DB_DIR], false);\n    const fileHandle = await dir.getFileHandle(\"chart-history.ndjson\");\n    const file = await fileHandle.getFile();\n    const text = await file.text();\n    const lines = text.split(/\\r?\\n/).filter(Boolean);\n    let imported = 0;\n    for (const line of lines) {\n      try {\n        const snapshot = JSON.parse(line);\n        if (snapshot?.id) {\n          await storeChartSnapshot(snapshot);\n          imported += 1;\n        }\n      } catch {\n        // skip bad lines\n      }\n    }\n    await writeStorageManifest(root, { lastImportAt: nowIso(), lastChartImport: imported });\n    return { ok: true, imported };\n  } catch {\n    return { ok: false, reason: \"missing\" };\n  }\n}\n\nexport async function importSavesFromExternal() {\n  const root = await getExternalStorageHandle({ requestPermission: true });\n  if (!root) return { ok: false, reason: \"permission\" };\n  if (typeof localStorage === \"undefined\") return { ok: false, reason: \"storage\" };\n  try {\n    const dir = await resolveDirectory(root, [SAVES_DIR], false);\n    const prefix = getSlotPrefix();\n    let imported = 0;\n    for await (const [name, handle] of dir.entries()) {\n      if (handle.kind !== \"file\") continue;\n      if (!name.startsWith(\"slot-\") || !name.endsWith(\".json\")) continue;\n      try {\n        const file = await handle.getFile();\n        const text = await file.text();\n        const data = JSON.parse(text);\n        const index = Number(name.replace(/[^0-9]/g, \"\"));\n        if (!Number.isFinite(index) || !data) continue;\n        localStorage.setItem(`${prefix}${index}`, JSON.stringify(data));\n        imported += 1;\n      } catch {\n        // skip invalid save\n      }\n    }\n    await writeStorageManifest(root, { lastImportAt: nowIso(), lastSaveImport: imported });\n    return { ok: true, imported };\n  } catch {\n    return { ok: false, reason: \"missing\" };\n  }\n}\n"]}