{"version":3,"file":"promo-budget.js","sourceRoot":"","sources":["../../../../../../src/app/ui/render/promo-budget.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-nocheck\nimport { state } from \"../../game.js\";\nimport { getPromoTypeCosts, PROMO_TYPE_DETAILS } from \"../../promo_types.js\";\n\nconst PROMO_BUDGET_MIN = 100;\n\nfunction getPromoInflationMultiplier() {\n  const currentYear = new Date(state.time?.epochMs || Date.now()).getUTCFullYear();\n  const baseYear = state.meta?.startYear || new Date(state.time?.startEpochMs || state.time?.epochMs || Date.now()).getUTCFullYear();\n  const yearsElapsed = Math.max(0, currentYear - baseYear);\n  const annualInflation = 0.02;\n  return Math.pow(1 + annualInflation, yearsElapsed);\n}\n\nfunction getModifierCosts(modifier, inflationMultiplier = 1) {\n  const baseCost = Number.isFinite(modifier?.basePrice) ? modifier.basePrice : 0;\n  const adjustedCost = Math.round(baseCost * Math.max(1, inflationMultiplier));\n  return { baseCost, adjustedCost };\n}\n\nfunction getRolloutBudgetForType(typeId, inflationMultiplier) {\n  const { adjustedCost } = getPromoTypeCosts(typeId, inflationMultiplier);\n  const raw = state.ui?.promoBudgets?.[typeId];\n  const parsed = Number(raw);\n  const fallback = Math.max(PROMO_BUDGET_MIN, adjustedCost);\n  if (!Number.isFinite(parsed)) return fallback;\n  return Math.max(PROMO_BUDGET_MIN, Math.round(parsed));\n}\n\nfunction buildRolloutBudgetSummary(strategy) {\n  if (!strategy || !Array.isArray(strategy.weeks)) return null;\n  const inflationMultiplier = getPromoInflationMultiplier();\n  const counts = {};\n  strategy.weeks.forEach((week) => {\n    (week?.events || []).forEach((eventItem) => {\n      const typeId = eventItem?.actionType || \"\";\n      if (!typeId) return;\n      counts[typeId] = (counts[typeId] || 0) + 1;\n    });\n  });\n  const entries = Object.entries(counts);\n  if (!entries.length) {\n    return {\n      eventCount: 0,\n      totalBase: 0,\n      totalAdjusted: 0,\n      totalPlanned: 0,\n      byType: []\n    };\n  }\n  const summary = {\n    eventCount: 0,\n    totalBase: 0,\n    totalAdjusted: 0,\n    totalPlanned: 0,\n    byType: []\n  };\n  entries.forEach(([typeId, count]) => {\n    const { baseCost, adjustedCost } = getPromoTypeCosts(typeId, inflationMultiplier);\n    const plannedCost = getRolloutBudgetForType(typeId, inflationMultiplier);\n    const label = PROMO_TYPE_DETAILS[typeId]?.label || typeId;\n    const entry = {\n      typeId,\n      label,\n      count,\n      baseCost,\n      adjustedCost,\n      plannedCost,\n      totalBase: baseCost * count,\n      totalAdjusted: adjustedCost * count,\n      totalPlanned: plannedCost * count\n    };\n    summary.eventCount += count;\n    summary.totalBase += entry.totalBase;\n    summary.totalAdjusted += entry.totalAdjusted;\n    summary.totalPlanned += entry.totalPlanned;\n    summary.byType.push(entry);\n  });\n  return summary;\n}\n\nexport {\n  buildRolloutBudgetSummary,\n  getModifierCosts,\n  getPromoInflationMultiplier\n};\n"]}