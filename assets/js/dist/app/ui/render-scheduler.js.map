{"version":3,"file":"render-scheduler.js","sourceRoot":"","sources":["../../../../../src/app/ui/render-scheduler.ts"],"names":[],"mappings":"AAuBA,MAAM,UAAU,qBAAqB,CAAC,MAA6B;IACjE,MAAM,KAAK,GAAgB;QACzB,GAAG,EAAE,KAAK;QACV,IAAI,EAAE,KAAK;QACX,KAAK,EAAE,KAAK;QACZ,KAAK,EAAE,KAAK;QACZ,MAAM,EAAE,KAAK;QACb,QAAQ,EAAE,KAAK;QACf,YAAY,EAAE,KAAK;KACpB,CAAC;IACF,IAAI,WAAW,GAAG,KAAK,CAAC;IACxB,IAAI,KAAK,GAAG,CAAC,CAAC;IAEd,MAAM,UAAU,GAAG,GAAG,EAAE;QACtB,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC;QAClB,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC;QACnB,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QACpB,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QACpB,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;QACrB,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;QACvB,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC;IAC7B,CAAC,CAAC;IAEF,MAAM,KAAK,GAAG,GAAG,EAAE;QACjB,KAAK,GAAG,CAAC,CAAC;QACV,MAAM,YAAY,GAAG,OAAO,MAAM,CAAC,SAAS,KAAK,UAAU,CAAC;QAC5D,IAAI,KAAK,CAAC,GAAG,IAAI,YAAY,EAAE,CAAC;YAC9B,MAAM,IAAI,GAAG,WAAW,CAAC;YACzB,WAAW,GAAG,KAAK,CAAC;YACpB,UAAU,EAAE,CAAC;YACb,MAAM,CAAC,SAAS,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;YAC7B,OAAO;QACT,CAAC;QACD,MAAM,QAAQ,GAAG,EAAE,GAAG,KAAK,EAAE,CAAC;QAC9B,MAAM,KAAK,GAAG;YACZ,EAAE,GAAG,EAAE,MAAM,EAAE,EAAE,EAAE,MAAM,CAAC,UAAU,EAAE;YACtC,EAAE,GAAG,EAAE,OAAO,EAAE,EAAE,EAAE,MAAM,CAAC,WAAW,EAAE;YACxC,EAAE,GAAG,EAAE,OAAO,EAAE,EAAE,EAAE,MAAM,CAAC,WAAW,EAAE;YACxC,EAAE,GAAG,EAAE,QAAQ,EAAE,EAAE,EAAE,MAAM,CAAC,YAAY,EAAE;YAC1C,EAAE,GAAG,EAAE,UAAU,EAAE,EAAE,EAAE,MAAM,CAAC,cAAc,EAAE;YAC9C,EAAE,GAAG,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,CAAC,kBAAkB,EAAE;SACvD,CAAC;QACF,UAAU,EAAE,CAAC;QACb,WAAW,GAAG,KAAK,CAAC;QACpB,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE;YAC5B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG;gBAAE,OAAO;YAC5C,IAAI,OAAO,EAAE,KAAK,UAAU;gBAAE,EAAE,EAAE,CAAC;QACrC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,GAAG,EAAE;QACxB,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,MAAM,CAAC,qBAAqB,KAAK,UAAU,EAAE,CAAC;YACxF,KAAK,EAAE,CAAC;YACR,OAAO;QACT,CAAC;QACD,IAAI,KAAK;YAAE,OAAO;QAClB,KAAK,GAAG,MAAM,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;IAC9C,CAAC,CAAC;IAEF,MAAM,QAAQ,GAAG,CAAC,GAAsB,EAAE,EAAE;QAC1C,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;QAClB,YAAY,EAAE,CAAC;IACjB,CAAC,CAAC;IAEF,OAAO;QACL,SAAS,EAAE,CAAC,OAA4B,EAAE,EAAE;YAC1C,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC;YACjB,WAAW,GAAG,WAAW,IAAI,OAAO,EAAE,IAAI,KAAK,KAAK,CAAC;YACrD,YAAY,EAAE,CAAC;QACjB,CAAC;QACD,UAAU,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;QAClC,WAAW,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC;QACpC,WAAW,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC;QACpC,YAAY,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;QACtC,cAAc,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC;QAC1C,kBAAkB,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC;KACnD,CAAC;AACJ,CAAC","sourcesContent":["type RenderAllFn = (options?: { save?: boolean }) => void;\ntype RenderFn = () => void;\n\ntype RenderSchedulerConfig = {\n  renderAll?: RenderAllFn;\n  renderTime?: RenderFn;\n  renderStats?: RenderFn;\n  renderSlots?: RenderFn;\n  renderMarket?: RenderFn;\n  renderEventLog?: RenderFn;\n  renderLossArchives?: RenderFn;\n};\n\ntype RenderQueue = {\n  all: boolean;\n  time: boolean;\n  stats: boolean;\n  slots: boolean;\n  market: boolean;\n  eventLog: boolean;\n  lossArchives: boolean;\n};\n\nexport function createRenderScheduler(config: RenderSchedulerConfig) {\n  const queue: RenderQueue = {\n    all: false,\n    time: false,\n    stats: false,\n    slots: false,\n    market: false,\n    eventLog: false,\n    lossArchives: false,\n  };\n  let pendingSave = false;\n  let rafId = 0;\n\n  const resetQueue = () => {\n    queue.all = false;\n    queue.time = false;\n    queue.stats = false;\n    queue.slots = false;\n    queue.market = false;\n    queue.eventLog = false;\n    queue.lossArchives = false;\n  };\n\n  const flush = () => {\n    rafId = 0;\n    const hasRenderAll = typeof config.renderAll === \"function\";\n    if (queue.all && hasRenderAll) {\n      const save = pendingSave;\n      pendingSave = false;\n      resetQueue();\n      config.renderAll?.({ save });\n      return;\n    }\n    const snapshot = { ...queue };\n    const calls = [\n      { key: \"time\", fn: config.renderTime },\n      { key: \"stats\", fn: config.renderStats },\n      { key: \"slots\", fn: config.renderSlots },\n      { key: \"market\", fn: config.renderMarket },\n      { key: \"eventLog\", fn: config.renderEventLog },\n      { key: \"lossArchives\", fn: config.renderLossArchives },\n    ];\n    resetQueue();\n    pendingSave = false;\n    calls.forEach(({ key, fn }) => {\n      if (!snapshot[key] && !snapshot.all) return;\n      if (typeof fn === \"function\") fn();\n    });\n  };\n\n  const requestFlush = () => {\n    if (typeof window === \"undefined\" || typeof window.requestAnimationFrame !== \"function\") {\n      flush();\n      return;\n    }\n    if (rafId) return;\n    rafId = window.requestAnimationFrame(flush);\n  };\n\n  const schedule = (key: keyof RenderQueue) => {\n    queue[key] = true;\n    requestFlush();\n  };\n\n  return {\n    renderAll: (options?: { save?: boolean }) => {\n      queue.all = true;\n      pendingSave = pendingSave || options?.save !== false;\n      requestFlush();\n    },\n    renderTime: () => schedule(\"time\"),\n    renderStats: () => schedule(\"stats\"),\n    renderSlots: () => schedule(\"slots\"),\n    renderMarket: () => schedule(\"market\"),\n    renderEventLog: () => schedule(\"eventLog\"),\n    renderLossArchives: () => schedule(\"lossArchives\"),\n  };\n}\n"]}