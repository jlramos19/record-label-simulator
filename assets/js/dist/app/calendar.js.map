{"version":3,"file":"calendar.js","sourceRoot":"","sources":["../../../../src/app/calendar.ts"],"names":[],"mappings":"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","sourcesContent":["type CalendarEvent = {\n  id?: string;\n  ts: number;\n  title?: string;\n  actName?: string;\n  label?: string;\n  labelColor?: string;\n  kind?: string;\n  typeLabel?: string;\n  distribution?: string;\n  className?: string;\n  showLabel?: boolean;\n};\n\ntype CalendarEraEntry = {\n  id?: string;\n  name?: string;\n  actName?: string;\n  stageName?: string;\n  startedWeek?: number;\n  content?: string;\n};\n\ntype CalendarSources = {\n  labelScheduled?: CalendarEvent[];\n  labelReleased?: CalendarEvent[];\n  tourScheduled?: CalendarEvent[];\n  rivalScheduled?: CalendarEvent[];\n  rivalReleased?: CalendarEvent[];\n  eras?: CalendarEraEntry[];\n};\n\ntype CalendarFilters = {\n  labelScheduled?: boolean;\n  labelReleased?: boolean;\n  tourScheduled?: boolean;\n  rivalScheduled?: boolean;\n  rivalReleased?: boolean;\n};\n\ntype CalendarProjectionConfig = {\n  startEpochMs: number;\n  anchorWeekIndex: number;\n  pastWeeks?: number;\n  futureWeeks?: number;\n  activeWeeks?: number;\n  tab?: string;\n  filters?: CalendarFilters;\n  sources?: CalendarSources;\n};\n\nconst DAY_MS = HOUR_MS * 24;\nconst MAX_EVENTS_PER_DAY = 3;\n\nfunction formatShortDate(epochMs) {\n  const date = new Date(epochMs);\n  const month = MONTHS[date.getUTCMonth()] || \"Month\";\n  const day = String(date.getUTCDate()).padStart(2, \"0\");\n  const year = date.getUTCFullYear();\n  return `${month.slice(0, 3)} ${day}, ${year}`;\n}\n\nfunction formatDayLabel(epochMs) {\n  const date = new Date(epochMs);\n  const dayName = DAYS[date.getUTCDay()] || \"Day\";\n  return dayName.slice(0, 3);\n}\n\nfunction formatEventTimeLabel(epochMs) {\n  if (!Number.isFinite(epochMs)) return \"\";\n  const date = new Date(epochMs);\n  const hours = String(date.getUTCHours()).padStart(2, \"0\");\n  const minutes = String(date.getUTCMinutes()).padStart(2, \"0\");\n  return hours === \"00\" && minutes === \"00\" ? \"\" : `${hours}:${minutes}`;\n}\n\nfunction formatRangeLabel(startWeek, endWeek, startEpochMs, endEpochMs) {\n  const weekLabel = startWeek === endWeek ? `Week ${startWeek}` : `Weeks ${startWeek}-${endWeek}`;\n  return `${weekLabel} | ${formatShortDate(startEpochMs)} - ${formatShortDate(endEpochMs)}`;\n}\n\nfunction escapeAttr(value) {\n  return String(value)\n    .replace(/&/g, \"&amp;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\");\n}\n\nfunction toKebabCase(value) {\n  return String(value || \"event\")\n    .replace(/([a-z0-9])([A-Z])/g, \"$1-$2\")\n    .replace(/\\s+/g, \"-\")\n    .toLowerCase();\n}\n\nexport function useCalendarProjection({\n  startEpochMs,\n  anchorWeekIndex,\n  pastWeeks = 0,\n  futureWeeks = 3,\n  activeWeeks = 4,\n  tab = \"label\",\n  filters = {},\n  sources = {}\n}: CalendarProjectionConfig) {\n  const labelScheduled = Array.isArray(sources.labelScheduled) ? sources.labelScheduled : [];\n  const labelReleased = Array.isArray(sources.labelReleased) ? sources.labelReleased : [];\n  const tourScheduled = Array.isArray(sources.tourScheduled) ? sources.tourScheduled : [];\n  const rivalScheduled = Array.isArray(sources.rivalScheduled) ? sources.rivalScheduled : [];\n  const rivalReleased = Array.isArray(sources.rivalReleased) ? sources.rivalReleased : [];\n  const eras = Array.isArray(sources.eras) ? sources.eras : [];\n\n  const showLabel = tab === \"label\" || tab === \"public\";\n  const showRivals = tab === \"public\";\n  const activeEvents = [];\n\n  if (showLabel && filters.labelScheduled !== false) activeEvents.push(...labelScheduled);\n  if (showLabel && filters.labelReleased !== false) activeEvents.push(...labelReleased);\n  if (showLabel && filters.tourScheduled !== false) activeEvents.push(...tourScheduled);\n  if (showRivals && filters.rivalScheduled !== false) activeEvents.push(...rivalScheduled);\n  if (showRivals && filters.rivalReleased !== false) activeEvents.push(...rivalReleased);\n\n  activeEvents.sort((a, b) => a.ts - b.ts);\n\n  const safeAnchor = Number.isFinite(anchorWeekIndex) ? anchorWeekIndex : 0;\n  const startWeekIndex = safeAnchor - Math.max(0, pastWeeks);\n  const totalWeeks = Math.max(1, Math.max(0, pastWeeks) + Math.max(0, futureWeeks) + 1);\n  const activeEndOffset = Math.max(0, activeWeeks - 1);\n\n  const weeks = [];\n  for (let i = 0; i < totalWeeks; i += 1) {\n    const weekIndex = startWeekIndex + i;\n    const offset = weekIndex - safeAnchor;\n    const isPreview = offset < 0 || offset > activeEndOffset;\n    const isAnchor = offset === 0;\n    const weekStart = startEpochMs + weekIndex * WEEK_HOURS * HOUR_MS;\n    const weekEnd = weekStart + WEEK_HOURS * HOUR_MS;\n    const weekEvents = activeEvents.filter((event) => event.ts >= weekStart && event.ts < weekEnd);\n    const days = [];\n\n    for (let dayIndex = 0; dayIndex < 7; dayIndex += 1) {\n      const dayStart = weekStart + dayIndex * DAY_MS;\n      const dayEnd = dayStart + DAY_MS;\n      const dayEvents = weekEvents.filter((event) => event.ts >= dayStart && event.ts < dayEnd);\n      days.push({\n        index: dayIndex,\n        start: dayStart,\n        end: dayEnd,\n        dayLabel: formatDayLabel(dayStart),\n        dateLabel: formatShortDate(dayStart),\n        events: dayEvents,\n        isPreview\n      });\n    }\n\n    weeks.push({\n      weekIndex,\n      offset,\n      isPreview,\n      isAnchor,\n      weekNumber: weekIndex + 1,\n      start: weekStart,\n      end: weekEnd,\n      days,\n      events: weekEvents\n    });\n  }\n\n  const rangeStart = weeks[0]?.start ?? startEpochMs;\n  const rangeEnd = weeks[weeks.length - 1]?.end ?? startEpochMs;\n  const rangeLabel = formatRangeLabel(startWeekIndex + 1, startWeekIndex + totalWeeks, rangeStart, rangeEnd - 1);\n\n  return {\n    tab,\n    filters,\n    weeks,\n    eras,\n    rangeLabel\n  };\n}\n\nexport function CalendarDayCell(day) {\n  const events = Array.isArray(day.events) ? day.events : [];\n  const visible = events.slice(0, MAX_EVENTS_PER_DAY);\n  const overflow = events.length - visible.length;\n  const dayClass = day.isPreview ? \"calendar-day is-preview\" : \"calendar-day\";\n  const eventHtml = visible.map((event) => {\n    const typeLabel = event.typeLabel || \"Event\";\n    const title = event.title || \"Untitled\";\n    const actName = event.actName || \"Unknown\";\n    const labelName = event.label || \"Label\";\n    const timeLabel = formatEventTimeLabel(event.ts);\n    const distribution = event.distribution ? `, ${event.distribution}` : \"\";\n    const timeDetail = timeLabel ? ` @ ${timeLabel}` : \"\";\n    const detail = `${labelName} | ${actName} | ${title} (${typeLabel}${timeDetail}${distribution})`;\n    const kindClass = event.className || toKebabCase(event.kind || \"event\");\n    const showLabel = event.showLabel && labelName;\n    const labelColor = showLabel ? event.labelColor || \"\" : \"\";\n    const labelStyle = labelColor ? ` style=\"--label-color:${escapeAttr(labelColor)}\"` : \"\";\n    const labelClass = labelColor ? \" has-label-color\" : \"\";\n    const labelLine = showLabel ? `<span class=\"calendar-event-label\">${labelName}</span>` : \"\";\n    const typeLine = timeLabel ? `${typeLabel} @ ${timeLabel}` : typeLabel;\n    return `\n      <div class=\"calendar-event calendar-event--${kindClass}${labelClass}\"${labelStyle} title=\"${escapeAttr(detail)}\">\n        <span class=\"calendar-event-type\">${typeLine}</span>\n        ${labelLine}\n        <span class=\"calendar-event-title\">${title}</span>\n      </div>\n    `;\n  }).join(\"\");\n  const overflowHtml = overflow > 0\n    ? `<div class=\"calendar-event calendar-event--more\" data-calendar-day-more data-day-ts=\"${day.start}\" role=\"button\" tabindex=\"0\">+${overflow} more</div>`\n    : \"\";\n\n  return `\n    <div class=\"${dayClass}\" data-day-ts=\"${day.start}\">\n      <div class=\"calendar-day-head\">\n        <div class=\"calendar-day-name\">${day.dayLabel}</div>\n        <div class=\"calendar-day-date\">${day.dateLabel}</div>\n      </div>\n      <div class=\"calendar-day-events\">\n        ${eventHtml || `<div class=\"calendar-day-empty\">-</div>`}\n        ${overflowHtml}\n      </div>\n    </div>\n  `;\n}\n\nexport function CalendarWeekRow(week) {\n  const days = Array.isArray(week.days) ? week.days : [];\n  const label = week.label || `Week ${week.weekNumber}`;\n  const dayCells = days.map((day) => CalendarDayCell(day)).join(\"\");\n  const rowClass = [\n    \"calendar-week-row\",\n    week.isPreview ? \"is-preview\" : \"\",\n    week.isAnchor ? \"is-anchor\" : \"\"\n  ].filter(Boolean).join(\" \");\n  return `\n    <div class=\"${rowClass}\">\n      <div class=\"calendar-week-label\">${label}</div>\n      <div class=\"calendar-week-days\">\n        ${dayCells}\n      </div>\n    </div>\n  `;\n}\n\nexport function CalendarView(projection) {\n  const weeks = Array.isArray(projection.weeks) ? projection.weeks : [];\n  if (!weeks.length) {\n    return `<div class=\"muted\">No calendar data available.</div>`;\n  }\n  const headerDays = Array.isArray(weeks[0]?.days) && weeks[0].days.length\n    ? weeks[0].days.map((day, index) => day.dayLabel || DAYS[index] || \"Day\")\n    : DAYS.map((day) => day.slice(0, 3));\n  const header = headerDays.map((day) => `\n    <div class=\"calendar-grid-day\">${day.slice(0, 3)}</div>\n  `).join(\"\");\n  const rows = weeks.map((week) => CalendarWeekRow(week)).join(\"\");\n\n  return `\n    <div class=\"calendar-grid\">\n      <div class=\"calendar-grid-header\">\n        <div class=\"calendar-grid-spacer\"></div>\n        ${header}\n      </div>\n      ${rows}\n    </div>\n  `;\n}\r\n"]}