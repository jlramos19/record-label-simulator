{"version":3,"file":"boot-status.js","sourceRoot":"","sources":["../../../../src/app/boot-status.ts"],"names":[],"mappings":"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","sourcesContent":["type BootStepStatus = \"pending\" | \"active\" | \"done\" | \"error\";\ntype BootStep = { id: string; label: string; detail: string; optional?: boolean };\ntype BootStepUpdate = { status?: BootStepStatus; label?: string; detail?: string };\ntype BootStatusController = {\n  setSummary: (text: string) => void;\n  updateStep: (id: string, update: BootStepUpdate) => void;\n  markReady: () => void;\n  show: () => void;\n};\n\nconst BOOT_STATUS_KEY = \"__RLS_BOOT_STATUS__\";\nconst DEFAULT_STEPS: BootStep[] = [\n  { id: \"boot\", label: \"Boot essentials\", detail: \"Checking data globals.\" },\n  { id: \"ui\", label: \"UI wiring\", detail: \"Binding controls and routes.\" },\n  { id: \"slot\", label: \"Save slot\", detail: \"Scanning for active slot.\" },\n  { id: \"charts\", label: \"Charts\", detail: \"Computing chart data.\" },\n  { id: \"render\", label: \"Render\", detail: \"Drawing UI panels.\" },\n  { id: \"external\", label: \"External storage (optional)\", detail: \"Save folder setup.\", optional: true }\n];\n\nfunction buildBootScreen() {\n  const screen = document.createElement(\"div\");\n  screen.id = \"bootScreen\";\n  screen.className = \"boot-screen\";\n  screen.setAttribute(\"role\", \"status\");\n  screen.setAttribute(\"aria-live\", \"polite\");\n  screen.innerHTML = `\n    <div class=\"boot-card\">\n      <div class=\"boot-title\">Loading Record Label Simulator</div>\n      <div id=\"bootSummary\" class=\"boot-summary\">Starting up...</div>\n      <div id=\"bootSteps\" class=\"boot-steps\" role=\"list\"></div>\n      <div class=\"boot-footnote\">Tip: reload if the loading screen stalls.</div>\n    </div>\n  `;\n  const host = document.body || document.documentElement;\n  host.appendChild(screen);\n  return screen;\n}\n\nexport function initBootStatus(): BootStatusController | null {\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") return null;\n  const existing = (window as typeof window & { __RLS_BOOT_STATUS__?: BootStatusController }).__RLS_BOOT_STATUS__;\n  if (existing) return existing;\n\n  const screen = document.getElementById(\"bootScreen\") || buildBootScreen();\n  const summaryEl = screen.querySelector(\"#bootSummary\") as HTMLElement | null;\n  const stepsEl = screen.querySelector(\"#bootSteps\") as HTMLElement | null;\n  if (!stepsEl) return null;\n\n  const stepElements = new Map<string, HTMLElement>();\n\n  const ensureStep = (step: BootStep) => {\n    const existingStep = stepElements.get(step.id);\n    if (existingStep) return existingStep;\n    const item = document.createElement(\"div\");\n    item.className = \"boot-step\";\n    item.dataset.step = step.id;\n    item.dataset.status = \"pending\";\n    if (step.optional) item.dataset.optional = \"true\";\n    item.innerHTML = `\n      <div class=\"boot-step-body\">\n        <div class=\"boot-step-label\">${step.label}</div>\n        <div class=\"boot-step-detail\">${step.detail}</div>\n      </div>\n    `;\n    stepsEl.appendChild(item);\n    stepElements.set(step.id, item);\n    return item;\n  };\n\n  DEFAULT_STEPS.forEach((step) => ensureStep(step));\n\n  const setSummary = (text: string) => {\n    if (summaryEl) summaryEl.textContent = text || \"\";\n  };\n\n  const updateStep = (id: string, update: BootStepUpdate) => {\n    if (!id) return;\n    const existingStep = stepElements.get(id);\n    const fallback = DEFAULT_STEPS.find((step) => step.id === id);\n    const step = existingStep\n      ? { id, label: existingStep.querySelector(\".boot-step-label\")?.textContent || id, detail: \"\" }\n      : fallback || { id, label: id, detail: \"\" };\n    const item = existingStep || ensureStep(step as BootStep);\n    if (!item) return;\n    if (update.status) item.dataset.status = update.status;\n    if (update.label) {\n      const labelEl = item.querySelector(\".boot-step-label\");\n      if (labelEl) labelEl.textContent = update.label;\n    }\n    if (update.detail) {\n      const detailEl = item.querySelector(\".boot-step-detail\");\n      if (detailEl) detailEl.textContent = update.detail;\n    }\n  };\n\n  const markReady = () => {\n    document.documentElement.dataset.bootReady = \"true\";\n    setSummary(\"Ready.\");\n  };\n\n  const show = () => {\n    document.documentElement.dataset.bootReady = \"false\";\n  };\n\n  const controller: BootStatusController = {\n    setSummary,\n    updateStep,\n    markReady,\n    show\n  };\n  (window as typeof window & { __RLS_BOOT_STATUS__?: BootStatusController }).__RLS_BOOT_STATUS__ = controller;\n  show();\n  return controller;\n}\n\nexport function getBootStatus(): BootStatusController | null {\n  if (typeof window === \"undefined\") return null;\n  return (window as typeof window & { __RLS_BOOT_STATUS__?: BootStatusController }).__RLS_BOOT_STATUS__ || null;\n}\n"]}